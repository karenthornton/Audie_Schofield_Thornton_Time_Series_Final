---
title: "Startups Funding"
author: "Michael Audie, Karen Thornton, Hannah Schofield"
date: "2023-04-01"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#load packages
library(lubridate)
library(ggplot2)
library(forecast)
library(tseries)
library(smooth)
library(dplyr)
```

#Data Wrangling - Full sets
```{r}
#load the data
start_up_funding.raw<-read.csv("./start_ups_funding.csv")

#only USD for unit
full_funding.df<-start_up_funding.raw[start_up_funding.raw$unit=="USD",]

#creating a df for only the early stage
early_stage.df<-full_funding.df[full_funding.df$funding.stage=="Early stage",]

#aggregating the values into each year (early stages)
early_stage_sum.df<-aggregate(value~year, data = early_stage.df,sum)
#adding the first month of each year to the data (early stages)
early_stage_sum.df$year<-as.Date(paste0(early_stage_sum.df$year,"-01-01"))

#creating a df for only the late stage
late_stage.df<-full_funding.df[full_funding.df$funding.stage=="Later stage",]

#aggregating the values into each year (late stages)
late_stage_sum.df<-aggregate(value~year, data = late_stage.df,sum)
#adding the first month of each year to the data (late stages)
late_stage_sum.df$year<-as.Date(paste0(late_stage_sum.df$year,"-01-01"))

```

#Data Wrangling - Training Sets
```{r}
#create an early stage df with the last year missing
early_stage_sum_training.df <- early_stage_sum.df %>%
  filter(between(year, as.Date("2000-01-01"), as.Date("2021-01-01")))

#create a late stage df with the last year missing
late_stage_sum_training.df <- late_stage_sum.df %>%
  filter(between(year, as.Date("2000-01-01"), as.Date("2021-01-01")))
```

#Creating Time Series
```{r}
#create time series for full datasets
early.ts<-ts(early_stage_sum.df[,2], start = c(2000,1), frequency = 1)
late.ts<-ts(late_stage_sum.df[,2], start = c(2000,1), frequency = 1)

#create time series for the training datasets
early.training.ts<-ts(early_stage_sum_training.df[,2], start = c(2000,1), frequency = 1)
late.training.ts<-ts(late_stage_sum_training.df[,2], start = c(2000,1), frequency = 1)
```

#Visualization
```{r}
#plot early and late full datasets
ggplot(early_stage_sum.df, aes(x=year))+
  geom_line(aes(y=early.ts,colour="Early"))+
  geom_line(aes(y=late.ts,colour="Later"))+
  scale_colour_manual(name="Stage of Funding", values =c("Early"="red","Later"="blue") )+
  theme_classic()+
  xlab("Year")+
  ylab("Startup Funding (USD)")
```

#Create ACFs and PACFs
```{r}
#create ACFs and PACFs for the full datasets
par(mar=c(3,3,3,0));par(mfrow=c(1,2))
Acf(early.ts,lag.max = 40,main="Early ACF",ylim=c(-1,1))
Pacf(early.ts,lag.max = 40,main="Early PACF",ylim=c(-1,1))
Acf(late.ts,lag.max = 40,main="Late ACF",ylim=c(-1,1))
Pacf(late.ts,lag.max = 40,main="Late PACF",ylim=c(-1,1))
```

#Model Fit - Arima (Early)
```{r}
#Fit the early data to an ARIMA


#Change these to have the training datasets
#early_ARIMA<-auto.arima(early.ts)
#summary(early_ARIMA)
#early_forecast<-forecast(early_ARIMA, h=3)
#autoplot(early_forecast)


#ES_early<-es(early.ts, h=1, silent=FALSE, holdout=FALSE)
```

#Model Fit - Arima (Late)
```{r}
#Fit the late data to an ARIMA
```
